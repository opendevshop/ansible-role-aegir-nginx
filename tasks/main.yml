---
# Variable setup.
- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

# Enable Aegir to access as a remote user.

- name: Symbolic link to Aegir's NGINX Config
  file:
    src: "{{ aegir_user_home }}/config/nginx.conf"
    dest: "{{ nginx_conf_path }}/aegir.conf"
    state: link
    force: yes

- name: Add aegir user to sudoers to reload NGINX
  lineinfile:
    dest: '{{ sudoers_file_path }}'
    regexp: '^{{ item }}'
    line: '{{ item }} ALL=NOPASSWD: {{ nginx_control }}'
    state: present
    validate: 'visudo -cf %s'
    create: yes
  with_items:
    - aegir
